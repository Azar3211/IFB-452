<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Processing & Logistics Interface</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
  <h1>Processing & Logistics DApp</h1>

  <h2>Process Catch</h2>
  <input type="text" id="catchId" placeholder="Catch ID (hex)">
  <input type="text" id="packaging" placeholder="Packaging type">
  <input type="text" id="cleaningNotes" placeholder="Cleaning Notes">
  <input type="number" id="paymentAmount" placeholder="Payment Amount">
  <label>
    Compliant:
    <input type="checkbox" id="compliant">
  </label>
  <button onclick="processCatch()">Process Catch</button>

  <h2>Add Logistics Update</h2>
  <input type="text" id="seafoodIdUpdate" placeholder="Seafood ID (hex)">
  <input type="text" id="location" placeholder="Location">
  <input type="text" id="temperature" placeholder="Temperature">
  <input type="text" id="status" placeholder="Status">
  <input type="text" id="batchNumber" placeholder="Batch Number">
  <input type="text" id="complianceNote" placeholder="Compliance Note">
  <input type="text" id="storageMethod" placeholder="Storage Method">
  <button onclick="addLogistics()">Add Update</button>

  <h2>Get Processing Info</h2>
  <input type="text" id="seafoodIdQuery" placeholder="Seafood ID (hex)">
  <button onclick="getProcessingInfo()">Get Info</button>
  <pre id="processingInfo"></pre>

  <h2>Get Logistics Update</h2>
  <input type="text" id="seafoodIdLog" placeholder="Seafood ID (hex)">
  <input type="number" id="logisticsIndex" placeholder="Index">
  <button onclick="getLogisticsUpdate()">Get Update</button>
  <pre id="logisticsInfo"></pre>

  <h2>All Seafood IDs</h2>
  <button onclick="getAllSeafoodIds()">List All</button>
  <ul id="seafoodList"></ul>

  <script>
    const contractAddress = "YOUR_CONTRACT_ADDRESS"; // Replace with deployed address
    const abi = [/* Insert ABI here */];
    let web3, contract;

    window.addEventListener("load", async () => {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: "eth_requestAccounts" });
        contract = new web3.eth.Contract(abi, contractAddress);
      } else {
        alert("Install MetaMask to use this app.");
      }
    });

    async function processCatch() {
      const accounts = await web3.eth.getAccounts();
      const catchId = document.getElementById("catchId").value;
      const packaging = document.getElementById("packaging").value;
      const cleaningNotes = document.getElementById("cleaningNotes").value;
      const compliant = document.getElementById("compliant").checked;
      const paymentAmount = document.getElementById("paymentAmount").value;

      try {
        const receipt = await contract.methods.processCatch(
          catchId, packaging, cleaningNotes, compliant, paymentAmount
        ).send({ from: accounts[0] });
        alert("Seafood processed! Tx Hash: " + receipt.transactionHash);
      } catch (err) {
        alert("Error: " + err.message);
      }
    }

    async function addLogistics() {
      const accounts = await web3.eth.getAccounts();
      const seafoodId = document.getElementById("seafoodIdUpdate").value;
      const location = document.getElementById("location").value;
      const temperature = document.getElementById("temperature").value;
      const status = document.getElementById("status").value;
      const batchNumber = document.getElementById("batchNumber").value;
      const complianceNote = document.getElementById("complianceNote").value;
      const storageMethod = document.getElementById("storageMethod").value;

      try {
        const receipt = await contract.methods.addLogisticsUpdate(
          seafoodId, location, temperature, status,
          batchNumber, complianceNote, storageMethod
        ).send({ from: accounts[0] });
        alert("Logistics update added! Tx Hash: " + receipt.transactionHash);
      } catch (err) {
        alert("Error: " + err.message);
      }
    }

    async function getProcessingInfo() {
      const seafoodId = document.getElementById("seafoodIdQuery").value;
      try {
        const info = await contract.methods.getProcessingInfo(seafoodId).call();
        document.getElementById("processingInfo").innerText = `
Catch ID: ${info[0]}
Packaging: ${info[1]}
Cleaning Notes: ${info[2]}
Compliant: ${info[3]}
Payment: ${info[4]}
Timestamp: ${new Date(info[5] * 1000).toLocaleString()}
Logistics Count: ${info[6]}
        `;
      } catch (err) {
        alert("Error: " + err.message);
      }
    }

    async function getLogisticsUpdate() {
      const seafoodId = document.getElementById("seafoodIdLog").value;
      const index = document.getElementById("logisticsIndex").value;
      try {
        const d = await contract.methods.getLogisticsUpdate(seafoodId, index).call();
        document.getElementById("logisticsInfo").innerText = `
Location: ${d[0]}
Temperature: ${d[1]}
Status: ${d[2]}
Batch Number: ${d[3]}
Compliance Note: ${d[4]}
Storage Method: ${d[5]}
Timestamp: ${new Date(d[6] * 1000).toLocaleString()}
        `;
      } catch (err) {
        alert("Error: " + err.message);
      }
    }

    async function getAllSeafoodIds() {
      try {
        const ids = await contract.methods.getAllSeafoodIds().call();
        const list = document.getElementById("seafoodList");
        list.innerHTML = "";
        ids.forEach(id => {
          const li = document.createElement("li");
          li.textContent = id;
          list.appendChild(li);
        });
      } catch (err) {
        alert("Error: " + err.message);
      }
    }
  </script>
</body>
</html>
